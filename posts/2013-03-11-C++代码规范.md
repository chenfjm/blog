---
layout: post
title: C++代码规范
category: cpp 
description: 
---

对代码规范的理解是每个人只要有自己的规范就行，代码是给自己看的，有多少个程序员就有多少种代码规范。而且一
直认为编码规范没有什么用处，我坚信这是浪费大家的编编程时间、影响效率的东西，我是大错特错了。

代码规范里不仅有编写代码的格式建议、命名约定、注释风格这样的东西，还有像头文件、类、作用域这些使用经验。
首先是头文件的用法，避免多重包含是学编程时最基本的要求;编写头文件时应该使用 #define 防止头文件被多重包含；为
保证唯一性,头文件的命名应该依据所在项目源代码树的全路径；使用前置声明可以显著减少需要包含的头文件数量；使用标准的
头文件包含顺序可增强可读性,项目内头文件应按照项目源代码目录树结构排列；前置声明是为了降低编译依赖。

作用域的使用，名字空间将全局作用域细分为独立的,具名的作用域,可有效防止全局作用域的命名冲突。名字空间分为匿名
名字空间和具名名字空间，不建议在.h文件中使用匿名名字空间；当公有嵌套类作为接口的一部分时,虽然可以直接将他们保持
在全局作用域中,但将嵌套类的声明置于名字空间内是更好的选择。当嵌套类只被外围类使用时非常有用;把它作为外围类作用域
内的成员,而不是去污染外部作用域的同名类。嵌套类可以在外围类中做前置声明, 然后在 .c文件中定义, 这样避免在外围类的
声明中定义嵌套类, 因为嵌套类的定义通常只与实现相关。
使用静态成员函数或名字空间内的非成员函数,尽量不要用裸的全局函数。某些情况下,非成员函数和静态成员函数是非常有
用的,将非成员函数放在名字空间内可避免污染全局作用域。定义在同一编译单元的函数,被其他编译单元直接调用可能会引入不
必要的耦合和链接时依赖;静态成员函数对此尤其敏感.。可以考虑提取到新类中, 或者将函数置于独立库的名字空间内。

变量的使用，将函数变量尽可能置于最小作用域内,并在变量声明时进行初始化C++允许在函数的任何位置声明变量。我们提
倡在尽可能小的作用域中声明变量,离第一次使用越近越好。这使得代码浏览者更容易定位变量声明的位置,了解变量的类型和初
始值。禁止用用 class类型的静态或全局变量，它们会导致很难发现bug和不确定的构造和析构函数调用顺序。静态生存周期的对
象, 包括全局变量,静态变量,静态类成员变量, 以及函数静态变量,都必须是原生数据类型。静态变量的构造函数,析构函数以及
初始化操作的调用顺序在 C++ 标准中未明确定义,甚至每次编译构建都有可能会发生变化, 从而导致难以发现的bug。

类的使用，构造函数中很难上报错误,不能使用异常，操作失败会造成对象初始化失败，进入不确定状态。如果在构造函数内
调用了自身的虚函数,这类调用是不会重定向到子类的虚函数实现。如果一个类定义了若干成员变量又没有其它构造函数,必须定
义一个默认构造函数。否则编译器将自动生产一个很糟糕的默认构造函数。防止隐式转换可用显示构造函数。仅在代码中需要拷
贝一个类对象的时候使用拷贝构造函数。truct用来定义包含数据的被动式对象,也可以包含相关的常量,但除了存取数据成员之外 ,没有别的函数功能。如果需要更多的函数功能,class更适合。

C++实践中,继承主要用于两种场合实现继承，子类继承父类的实现代码;接口继承，子类仅继承父类的方法名称。真正需要用到
多重实现继承的情况少之又少。只在以下情况我们才允许多重继承最多只有一个基类是非抽象类。除少数特定环境外，不要重载运算
符。将所有数据成员声明为private,并根据需要提供相应的存取函数，一般在头文件中把存取函数定义成内联函数。在类中使用特定
的声明顺序public在private之前,成员函数在数据成员前;类的 访问控制区段的声明顺序依次为public,protected,private。如果某
区段没内容, 可以不声明。

C++的其他特性还有引用参数，友元，异常，运行时类型识别，类型转换，流，前置自增和自减，const的使用，预处理宏，0
和NULL，Boost库等等。最后就是一些使用约定，包括命名规则，注释风格等简单的规定。  
